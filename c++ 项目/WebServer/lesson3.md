## 1  静态库的制作

### 1.1  什么是库？
**库（Library）** 是一组预编译的函数、类或资源的集合，供程序在开发时调用。库的目的是为了代码复用，避免重复编写相同的功能。通过使用库，开发者可以专注于实现核心逻辑，而不必从头实现一些通用的功能（如数学计算、文件操作、网络通信等）。

库通常分为两种类型：**静态库** 和 **动态库**。

---

### 1.2  静态库（Static Library）
静态库在编译时会被完整地复制到最终的可执行文件中。它的特点包括：
1. **编译时链接**：静态库的代码会被直接嵌入到生成的可执行文件中。
2. **独立性**：生成的可执行文件不依赖外部的库文件，可以直接运行。
3. **文件体积较大**：因为库的代码被复制到可执行文件中，所以可执行文件的体积会变大。
4. **更新困难**：如果静态库更新了，所有使用它的程序都需要重新编译。

#### 1.2.1  静态库的文件扩展名
- 在 Linux/Unix 系统中，静态库的文件名通常以 `.a` 结尾（例如 `libmylib.a`）。
- 在 Windows 系统中，静态库的文件名通常以 `.lib` 结尾。

#### 1.2.2  创建静态库
在 Linux 中，可以使用 `ar` 工具创建静态库：
```bash
# 编译源文件生成目标文件
gcc -c mylib.c -o mylib.o

# 将目标文件打包成静态库
ar rcs libmylib.a mylib1.o mylib2.o ...　
```

+   options：
    +   r：将文件插入备份文件中
    +   c：建立备份文件
    +   s：索引
+   静态库命名规则：libxxx.a
    +   lib：前缀（固定）
    +   xxx：库名
    +   .a：后缀（固定）

#### 1.2.3  使用静态库

```bash
gcc -o myprogram myprogram.c -L. -lmylib
```

---

### 1.3  动态库（Dynamic Library / Shared Library）
动态库在程序运行时才会被加载到内存中，多个程序可以共享同一个动态库。它的特点包括：
1. **运行时链接**：动态库的代码不会嵌入到可执行文件中，而是在程序运行时加载。
2. **文件体积较小**：可执行文件只包含对动态库的引用，因此体积较小。
3. **共享性**：多个程序可以共享同一个动态库，节省内存和磁盘空间。
4. **更新方便**：如果动态库更新了，只需要替换库文件，而不需要重新编译使用它的程序。
5. **依赖性问题**：程序运行时需要确保动态库存在，否则会报错。

#### 1.3.1  动态库的文件扩展名
- 在 Linux/Unix 系统中，动态库的文件名通常以 `.so` 结尾（例如 `libmylib.so`）。
- 在 Windows 系统中，动态库的文件名通常以 `.dll` 结尾。

#### 1.3.2  创建动态库
在 Linux 中，可以使用 `gcc` 创建动态库：
```bash
# 编译源文件生成动态库
gcc -fPIC -shared -o libmylib.so mylib.c
```

#### 1.3.3  使用动态库
```bash
gcc -o myprogram myprogram.c -L. -lmylib

# 运行程序时需要确保动态库在系统的库路径中，或者设置 LD_LIBRARY_PATH
export LD_LIBRARY_PATH=.:$LD_LIBRARY_PATH
./myprogram
```

---

### 1.4  静态库和动态库的区别
| 特性         | 静态库                           | 动态库                         |
| ------------ | -------------------------------- | ------------------------------ |
| **链接时机** | 编译时链接                       | 运行时链接                     |
| **文件体积** | 可执行文件较大                   | 可执行文件较小                 |
| **内存占用** | 每个程序都包含库代码，内存占用高 | 多个程序共享库代码，内存占用低 |
| **更新方式** | 需要重新编译程序                 | 只需替换库文件                 |
| **依赖性**   | 无依赖，独立运行                 | 依赖外部库文件                 |
| **加载速度** | 较快（库代码已嵌入）             | 较慢（运行时加载）             |
| **适用场景** | 小型程序或嵌入式系统             | 大型程序或多程序共享库的场景   |

---

### 1.5  选择静态库还是动态库？
- **静态库** 适合小型程序或嵌入式系统，因为它的独立性强，不需要依赖外部文件。
- **动态库** 适合大型程序或多个程序共享库的场景，因为它可以节省磁盘空间和内存，并且更新方便。

在实际开发中，可以根据具体需求选择合适的库类型。