## 1  Makefile 函数速查

### 1.1  字符串处理函数

- **`$(subst from,to,text)`**
    - **功能**：文本替换。将 `text` 中所有 `from` 替换为 `to`。
    - **注意**：逗号后无空格，除非空格是需替换字符。
    - **与变量替换引用比较**：`subst` 更灵活，可替换任意位置。

- **`$(patsubst pattern,replacement,text)`**
    - **功能**：模式替换。将 `text` 中**以空格分隔**、匹配 `pattern` 的单词替换为 `replacement`（`%` 代表通配）。
    - **与 `subst` 比较**：`subst` 是全局文本替换；`patsubst` 以单词为单位进行模式匹配和替换。

- **`$(strip string)`**
    - **功能**：去除字符串首尾空格，并将内部连续空格压缩为单个空格。

- **`$(findstring find,in)`**
    - **功能**：在 `in` 中查找 `find`，找到则返回 `find`，否则返回空。**区分大小写**。

- **`$(filter pattern…,text)` / `$(filter-out pattern…,text)`**
    - **功能**：返回 `text` 中符合（`filter`）或不符合（`filter-out`）给定模式（空格分隔）的单词。

- **`$(sort list)`**
    - **功能**：将 `list` 中单词按字典序排序并**去重**。

- **`$(word n,text)`**
    - **功能**：返回 `text` 中第 `n` 个单词（从 1 开始）。`n` 无效则返回空。

- **`$(wordlist s,e,text)`**
    - **功能**：返回 `text` 中第 `s` 到第 `e` 个单词的列表。

- **`$(words text)`**
    - **功能**：返回 `text` 中单词总数。

- **`$(firstword text)` / `$(lastword text)`**
    - **功能**：返回 `text` 中第一个/最后一个单词。

- **`$(foreach var,list,expr)`**
    - **功能**：将 `list` 中每个单词赋给 `var`，展开 `expr`，最后将所有展开结果用空格连接返回。

- **`$(let vars,list,expr)`** (GNU make 4.4+)
    - **功能**：将 `list` 中单词依次赋给 `vars` 中变量（空格分隔），多余变量赋空，最后展开 `expr`。
    - **变量与列表对应关系**：
        - 变量数 < 列表项数：前 N-1 个变量各获一项，最后一个变量获剩余所有项。
        - 变量数 = 列表项数：一一对应。
        - 变量数 > 列表项数：前 N 个变量对应列表项，其余变量赋空。

### 1.2  文件名处理函数

- **`$(dir names…)` / `$(notdir names…)`**
    - **功能**：返回文件路径中的目录部分（`dir`）或文件名部分（`notdir`）。本质是字符串操作，与文件系统无关。

- **`$(suffix names…)` / `$(basename names…)`**
    - **功能**：返回文件名的后缀部分（`suffix`，含点）或除后缀外的部分（`basename`，含路径）。

- **`$(addsuffix suffix,names…)` / `$(addprefix prefix,names…)`**
    - **功能**：为 `names` 中每个单词添加指定后缀（`addsuffix`）或前缀（`addprefix`）。

- **`$(join list1,list2)`**
    - **功能**：将 `list1` 与 `list2` 中对应单词连接。长度不同时，较长列表多出部分原样返回。

### 1.3  文件检索函数

- **`$(wildcard pattern…)`**
    - **功能**：返回匹配通配符模式（如 `*.c`）的真实存在的文件列表。

- **`$(realpath names…)` / `$(abspath names…)`**
    - **功能**：返回文件的绝对路径。若文件不存在，`realpath` 返回空；`abspath` 将当前目录作为其路径返回。

### 1.4  条件函数

- **`$(if condition,then-part[,else-part])`**
    - **功能**：若 `condition` 展开非空，返回 `then-part`，否则返回 `else-part`。

- **`$(or cond1[,cond2…])`**
    - **功能**：返回第一个非空条件，或空。

- **`$(and cond1[,cond2…])`**
    - **功能**：所有条件非空则返回最后一个条件，否则返回空。

- **`$(intcmp lhs,rhs[,lt-part[,eq-part[,gt-part]]])`**
    - **功能**：比较整数 `lhs` 和 `rhs`，根据大小关系返回对应部分。仅两个参数时，相等返回数值，否则返回空。

### 1.5  变量信息检索函数

- **`$(value var)`**
    - **功能**：返回变量 `var` 的未展开的定义本身（递归变量）或其值（简单展开变量）。

- **`$(origin var)`**
    - **功能**：返回变量 `var` 的来源，如 `undefined`（未定义）、`default`（默认）、`environment`（环境）、`file`（自定义）、`automatic`（自动变量）。

- **`$(flavor var)`**
    - **功能**：返回变量 `var` 的展开方式：`undefined`（未定义）、`recursive`（递归展开）、`simple`（简单展开）。

### 1.6  信息提示函数

- **`$(error text…)`**
    - **功能**：输出错误信息并终止 make 过程。

- **`$(warning text…)`**
    - **功能**：输出警告信息，但继续执行。

- **`$(info text…)`**
    - **功能**：输出信息。

### 1.7  其他重要函数

- **`$(file op filename[,text])`**
    - **功能**：文件操作。`op` 为 `>`（覆盖写）、`>>`（追加写）或 `<`（读）。读操作返回文件内容。

- **`$(eval text)`**
    - **功能**：将 `text` 的内容作为 Makefile 语法解析并执行。用于动态生成规则或变量。

- **`$(shell command)`**
    - **功能**：执行 shell 命令 `command` 并返回其输出。类似于 `!=` 赋值操作符。

### 1.8  自定义函数

- **定义**：`func_name = $(expression with $(1),$(2)…)`。`$(1)`,`$(2)`… 代表参数。
- **调用**：`$(call func_name,arg1,arg2,…)`。返回函数展开结果。
