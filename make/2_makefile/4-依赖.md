依赖分为**普通依赖与 order-only 依赖**两种类型。

**两种依赖通过 `|` 分隔**，左边为普通依赖列表，右边为 order-only 列表。

```makefile
target : 普通依赖1 普通依赖2 … | order-only1 order-only2 …
```

## 1  普通依赖

- 如果这一依赖是由其他规则生成的文件，那么当执行到该规则时，会先执行生成这一依赖的规则。
- 如果任何一个依赖目标最终修改时间比目标晚，则重新编译生成目标文件。

## 2  order-only 依赖

- 当依赖文件不存在时，会执行对应方法生成。
- **依赖文件的更新不会导致目标文件的更新**。
	- 检查目标文件更新时，不会检查 order-only 依赖文件的更新

## 3  指定依赖路径

当 Makefile 文件与依赖文件处于不同的目录时，需要通过 `VPATH` 或 `vpath` 指定依赖文件的查找路径。

### 3.1  通过变量 `VPATH` 指定搜索路径

`VPATH` 是一个全局变量，用于指定**所有文件类型**的全局搜索路径。

```makefile
VPATH = dirPath1:dirPath2:…
```

- dirPath：就是需要搜索的目录路径，可以是相对路径，也可以是绝对路径
- 目录之间用 `:` 隔开

设置 VPATH 之后，make 工具在建立依赖图时，便会从给出的路径中搜索

#### 3.1.1  查找顺序

- 当 `make` 需要解析某个依赖文件（如 `foo.c`）时，首先检查当前目录是否存在。
- 如果不存在，按 `VPATH` 定义的**目录顺序**依次查找（如先 `src/`，再 `lib/`）。
- 如果多个目录中存在同名文件，`make` 会使用第一个找到的文件。

### 3.2  通过 `vpath` 指令指定搜索路径

`vpath` 用法比 `VPATH` 使用更加灵活，可以为不同文件类型指定不同的搜索路径

```makefile
vpath <pattern> <directories>
```

- `<pattern>`：通配符模式
- `<directories>`：目录列表，用空格或冒号分隔

例子

```makefile
# .h 文件夹在 include 目录内搜索
vpath %.h include

# .h 文件夹在 include/header 目录内搜索
vpath %.h include:header

# 所有文件在 src 中搜索
vpath % src

# inputh.cpp 文件在 src 中搜索
vpath input.cpp src
```

#### 3.2.1  查找顺序

- `vpath` 的路径优先级高于全局变量 `VPATH`
- 搜索顺序按照 `vpath` 声明的顺序查找

## 4  自动生成头文件依赖

```makefile
DEPFLAGS = -MMD -MP
DEPFILES := $(OBJS:.o=.d)
-include $(DEPFILES)
```
