## 1 基本概念

### 1.1 **模式规则（Pattern Rules）**

- **语法**：使用 `%` 作为通配符，匹配文件名中的任意字符串。
- **示例**：将所有的 `.c` 文件编译为 `.o` 文件

  ```makefile
  %.o: %.c
      $(CC) -c $< -o $@
  ```

  - `%.o`：匹配任意以 `.o` 结尾的目标文件。
  - `%.c`：匹配对应的 `.c` 源文件。
  - `$<` 和 `$@` 是自动变量，分别代表依赖列表中的第一个文件和目标文件名。

### 1.2 **通配符（Wildcard）**

- **`*` 和 `?`**：在目标和命令中使用，匹配文件名。

  ```makefile
  # 匹配所有 .c 文件
  SRC_FILES = $(wildcard *.c)
  # 将 .c 替换为 .o
  OBJ_FILES = $(patsubst %.c,%.o,$(SRC_FILES))
  ```

## 2 自动变量

详情请见 变量 [9.6.1  自动变量](#9.6.1%20自动变量)

## 3 **静态模式规则（Static Pattern Rules）**

- **作用**：限定模式规则的适用范围，避免全局匹配。

```makefile
## 4  仅对 $(OBJ_FILES) 列表中的文件应用模式规则
$(OBJ_FILES): %.o: %.c
	$(CC) -c $< -o $@
```

## 4 **跨目录匹配**

- **`vpath` 指令**：指定搜索依赖文件的目录。

```makefile
# 告诉 Make 在 src/ 和 lib/ 目录中查找 .c 文件
vpath %.c src/:lib/

%.o: %.c
    $(CC) -c $< -o $@
```

## 5 优先级规则

  - **显式规则 > 静态模式规则 > 隐式规则**。
  - 如果多个模式匹配同一目标，优先执行## 7 dd ￼第一个匹配的规则。
- **示例**：

  ```makefile
  # 显式规则优先
  special.o: special.c
      $(CC) -c -O2 $< -o $@

  # 通用模式规则
  %.o: %.c
      $(CC) -c $< -o $@
  ```
